<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description>Deploys the sample application into staging project</description>
  <logRotator class="hudson.tasks.LogRotator">
    <daysToKeep>-1</daysToKeep>
    <numToKeep>5</numToKeep>
    <artifactDaysToKeep>-1</artifactDaysToKeep>
    <artifactNumToKeep>-1</artifactNumToKeep>
  </logRotator>
  <keepDependencies>false</keepDependencies>
  <properties>
    <com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty plugin="naginator@1.15">
      <optOut>false</optOut>
    </com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty>
    <se.diabol.jenkins.pipeline.PipelineProperty plugin="delivery-pipeline-plugin@0.8.11">
      <taskName>Stage</taskName>
      <stageName>Deploy</stageName>
    </se.diabol.jenkins.pipeline.PipelineProperty>
  </properties>
  <scm class="com.openshift.jenkins.plugins.pipeline.OpenShiftImageStreams" >
    <imageStreamName>sample-app</imageStreamName>
    <tag>latest</tag>
    <apiURL>https://openshift.default.svc.cluster.local</apiURL>
    <namespace>ci</namespace>
    <authToken></authToken>
  </scm>
  <assignedNode>master</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers>
    <hudson.triggers.SCMTrigger>
      <spec>H/2 * * * *</spec>
      <ignorePostCommitHooks>false</ignorePostCommitHooks>
    </hudson.triggers.SCMTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    
    <!--
	The sample-app deployment config for the stage project as defined at https://github.com/openshift/origin/examples/jenkins/sample-app-masterslave-stage.json
	has an image change trigger on the image stream tag defined and leveraged in the ci project as defined in https://github.com/openshift/origin/examples/jenkins/sample-app-masterslave-ci.json.
	When the sample-app-build job in the `ci` project updates that image, it should trigger a deployment in the stage project.  Then this job's image stream polling will detect that change, and
	start monitoring that the deployment is valid and a replica is up and ready for testing immediatly (since the deployment config in this project has a non-zero value for replicas).  Although
	not part of this sample, typically an email notification Jenkins post-build action would be set up (assuming SMTP is set up in the Jenkins enviornment) to notify QE/QA a new image is ready
	for testing.
    -->
    
    <com.openshift.jenkins.plugins.pipeline.OpenShiftDeploymentVerifier>
      <apiURL>https://openshift.default.svc.cluster.local</apiURL>
      <depCfg>frontend</depCfg>
      <namespace>stage</namespace>
      <replicaCount>1</replicaCount>
      <authToken></authToken>
    </com.openshift.jenkins.plugins.pipeline.OpenShiftDeploymentVerifier>

  </builders>
  <buildWrappers/>
</project>

